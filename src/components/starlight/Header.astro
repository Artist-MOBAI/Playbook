---
import PlaybookLogo from "../../assets/images/logo/playbook.svg";
import EditPageEditor from "../editor/EditPageEditor";

const rawFiles = import.meta.glob("/src/content/docs/**/*.mdx", {
  query: "?raw",
  import: "default",
  eager: true,
}) as Record<string, string>;

const pathname = Astro.url.pathname.replace(/^\/|\/$/g, "");
let pageSource = "";
for (const [, content] of Object.entries(rawFiles)) {
  const frontmatter = content.match(/^---\n([\s\S]*?)\n---/);
  const slug = frontmatter?.[1].match(/slug:\s*(.+)/)?.[1]?.trim();
  if (slug === pathname) {
    pageSource = content;
    break;
  }
}
const hasSource = pageSource.length > 0;
---

<div
  class="w-full px-4 md:px-8 flex justify-between items-center h-15 bg-[#0E0E0E] border-b border-(--color-border)"
>
  <a href="/" class="flex items-center">
    <PlaybookLogo height={15} />
  </a>
  <!-- {
    hasSource && (
      <button
        id="edit-page-btn"
        class="flex items-center justify-center gap-1.5 h-8 px-3 rounded-lg bg-transparent text-(--color-muted) border border-(--color-border) cursor-pointer text-[13px] font-medium transition-all duration-150 font-[inherit] leading-none hover:text-(--color-text) hover:border-(--color-text) hover:bg-white/4 active:scale-[0.97] max-[49.99rem]:mr-11"
        title="编辑此页"
      >
        <svg
          width="16"
          height="16"
          viewBox="0 0 16 16"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="block shrink-0"
        >
          <path
            d="M11.333 1.333a1.886 1.886 0 0 1 2.667 0l.667.667a1.886 1.886 0 0 1 0 2.667L5.333 14H2v-3.333l9.333-9.334ZM10 2.667l3.333 3.333"
            stroke="currentColor"
            stroke-width="1.2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
        <span class="leading-none">编辑此页</span>
      </button>
    )
  } -->
</div>

<!-- {hasSource && <EditPageEditor client:only="react" source={pageSource} />}

<script>
  const closeIcon = "M4 4L12 12M4 12L12 4";
  const editIcon =
    "M11.333 1.333a1.886 1.886 0 0 1 2.667 0l.667.667a1.886 1.886 0 0 1 0 2.667L5.333 14H2v-3.333l9.333-9.334ZM10 2.667l3.333 3.333";

  function initEditButton() {
    const btn = document.getElementById("edit-page-btn");
    if (!btn) return;

    let editing = false;
    const icon = btn.querySelector("svg")!;
    const label = btn.querySelector("span")!;

    document.body.classList.remove("is-editing");

    function updateButton() {
      label.textContent = editing ? "退出编辑" : "编辑此页";
      const path = icon.querySelector("path")!;
      path.setAttribute("d", editing ? closeIcon : editIcon);
    }

    btn.addEventListener("click", () => {
      editing = !editing;
      updateButton();
      window.dispatchEvent(
        new CustomEvent(
          editing ? "edit-page-activate" : "edit-page-deactivate",
        ),
      );
    });
  }

  initEditButton();
</script>

<style is:global>
  @media (max-width: 49.99rem) {
    body.is-editing #edit-page-btn {
      margin-right: 0;
    }
  }
</style> -->
